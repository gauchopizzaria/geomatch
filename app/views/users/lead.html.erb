<!-- app/views/users/lead.html.erb -->
<div class="container mt-5 lead-wrapper">
  <h1 class="text-center">Descubra Pessoas Próximas</h1>

  <% if @next_user %>
    <div class="lead-card">
      <% if @next_user.avatar.attached? %>
        <%= image_tag @next_user.avatar, class: "lead-card-image" %>
      <% end %>

      <div class="lead-card-info">
        <h5 class="card-title"><%= @next_user.display_name %></h5>
        <p class="card-text"><%= @next_user.bio %></p>

        <% if @distance %>
          <p class="card-text"><%= @distance %> km</p>
        <% end %>

        <% if @next_user.hobbies_list.any? %>
          <p class="card-text small">
            Hobbies: <%= @next_user.hobbies_list.join(', ') %>
          </p>
        <% end %>
      </div>
    </div>

    <!-- Botões de Ação -->
    <div class="lead-actions">
      <%= link_to "❌", lead_path, class: "action-button reject-button" %>

      <%= button_to "❤️", likes_path(user_id: @next_user.id),
            method: :post,
            data: { turbo_confirm: "Tem certeza que deseja curtir?" },
            class: "action-button like-button",
            id: "like-button" %>
    </div>

  <% else %>
    <div class="alert alert-info text-center" role="alert">
      Não há mais usuários elegíveis no momento. Tente novamente mais tarde!
    </div>
  <% end %>
</div>

<!-- Script Turbo -->
<script>
  document.addEventListener('turbo:submit-end', function(event) {
    const response = event.detail.fetchResponse;
    if (response.ok) {
      response.json().then(data => {
        alert(data.message);
        window.location.reload();
      });
    } else {
      alert("Erro ao processar a curtida.");
    }
  });
</script>
